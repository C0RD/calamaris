.TH CALAMARIS 1 "$Date: 2000-05-13 20:06:45 $" Handmade "Calamaris Manual"

.SH NAME
calamaris \- generate statistic out of log files from 
.BR Squid ,
.B NetCache
and relatives

.SH SYNOPSIS
cat log |
.B calamaris
[ calamaris_options ]

.SH DESCRIPTION
.B Calamaris
is used to produce statistical output from
.BR Squid ,
.B NetCache
or related Proxy log files.  The resulting output can be
.I ascii
or
.IR html .
It is possible to cache calculated data in a file to use them in later runs.

This manual page describes the options of
.B Calamaris
and gives a few examples.

.SH OPTIONS

.SS Reports

.TP
.I -a
all: extracts all reports available,
.I -a
equals
.IR "-d 20 -P 60 -r -1 -s -t 20" . 

.TP
.I -d n
domain report: switches the top level and the second level report on.  The
data is derived from the URL.  The output is limited by n.  (-1 is unlimited)

.TP
.I -p type
peak report: Measures the peaks of the Proxy usage in requests per second, 
per minute and per hour.  It reports peaks for TCP, UDP and ALL requests. If 
set to
.I 'old'
these values were calculated with the old slow method, if set to
.I 'new'
the new faster (but still slow) method is used. 

.TP
.I -P n
performance report: Shows the throughput of TCP requests for every n minutes.

.TP
.I -r n
requester report: Switches the UDP and TCP requester reports on.  The output
is limited by n.  (-1 is unlimited)

.TP
.I -s
status report: alters the default behaviour of
.B Calamaris
and makes the status reports more verbose.

.TP
.I -t n
type report: switches the content type and the file extension report on.  The
output is limited by n.  (-1 is unlimited)

.SS Input Format
.TP
.I -f type
format: sets the type of input logfiles. If set to

.I 'auto'
.B Calamaris
tries to guess the input file format.  This will be the Default
in a later release.

.B Note:
If the first line of your input file is corrupted, Calamaris will
stop with an error.

.I 'squid'
.B Calamaris 
expects native logfile derived from Squid V1.1.beta26-V2.x. This is the
Default.

.I 'squid-mime' 
.B Calamaris 
expects native logfile with enabled derived from Squid V1.1.alpha1-V1.1.beta25
with
.I log_mime_hdrs 
enabled. (This only enables parsing of these kind of logfile, the additional
data will be ignored.)

.B Warning:
Logging of MIME-Headers breaks the privacy of your users!

.I 'squid-old' 
.B Calamaris 
expects native logfile derived from Squid V1.1.alpha1-V1.1.beta25. 

.I 'nc'
it expects Logfiles from NetCache. (Please see the README on this.)

.SS Output Format
Standard output format is plain ascii with 80 chars width.

.TP
.I -m
mail: adds a subject header to the beginning of the report.

.TP
.I -w
web: all output is given in html with tables and such.  Can be combined with
.I -m
to send html mails.

.TP
.I -l string
logo: add a custom string to a HTML-Report. It'll be added to a table on the
top of the output.
.I -l '<A HREF="http://cord.de/"><IMG BORDER=0 SRC="http://cord.de/Images/cord/cordlog2n.gif" ALT="Cord"></A>' 
will add my logo with a link to the Report.

.B Note:
.I -l 
works only in combination with
.IR -w.

.SS Caching

.TP
.I -i file
input file: You can reuse a cache file generated with
.I -o file
to add old data to a new report.  Several files can be seperated with a ':'.

.B Note:
if you use more than one cache file, make sure they are chronologicaly
ordered (oldest first).

.TP
.I -o file
output file:
.B Calamaris
stores a summary of the computed information in
.I file
and you can reuse it at a later time with
.IR -i .

.B Note:
The output file can be the same as the input file: it is simply overwritten
after reading the data.  It is not recommended to change the options between
different runs if you include older data as this can result in strange
measurements.

.SS Misc

.TP
.I -H name
host name: The name for the title or subject of the output.  If set to
.I 'lookup'
.B Calamaris
looks up the host name of the system its been run on.

.TP
.I -n
no lookup: Switches the IP lookup for the requesters off.

.TP
.I -O
order: Changes the sort order in the reports to request size, default is
sorting by number of requests.

.TP
.I -T
Time: Adjust the Performancereport for non GMT-Timezoners.

.TP
.I -c
case: Switch to case-insensitive. This is useful for the
'Requested extensions' report.

.TP
.I -u
user: Switches the usage of eventually available ident information for
requester reports on.

.B Warning:
This breaks the privacy of your users!

.TP
.I -z
zero: Switches reading from standard input off.  You can use this to merge
many cache files to one (see
.I -i
and
.IR -o )
or to generate a report out of cache files.

.TP
.I -b n
benchmark: A switch for the impatient as it prints a '#' for every n parsed
lines.

.TP
.I -v
verbose: print more information about what is Calamaris is doing
and beleiving.

.TP
.I -C
Copyright: Prints the copyright information of
.BR Calamaris .

.TP
.I -h
help: Prints a brief description of the command line options.

.TP
.I -V
Version: Prints out the Version-Number.

.SH EXAMPLES

.TP
This example mails the daily statistics to root:
cat /var/log/squid/access.log | nice -39 
.B calamaris
-amH 'daily worf' | mail root

.TP
This one only caches a summary for later use:
cat /var/log/squid/access.log |
.B calamaris
-a -o daily.`date +"%w"` > /dev/null

.TP
You can then use the caches to have weekly statistics:

if [ $DAYOFWEEK = "0" ]; then
.B calamaris 
-a -i daily.1:daily.2:daily.3:daily.4:daily.5:daily.6:daily.0 -zmH "weekly worf" | mail root
fi

.SH BUGS
If you have a problem with
.BR Calamaris ,
please make sure that you use the recent version of 
.B Calamaris 
(see VERSION below). Also check that your proxy works correctly and doesn't produce
invalid Logfiles. (see the README for this.)

If you're sure that you've encountered a bug in Calamaris, please report it to
Calamaris-bug@cord.de. This also applies if Calamaris itself says 'please
report this'.

.SH "SEE ALSO"
.B squid(8)

.SH AUTHOR
Cord Beermann <Cord@Wunder-Nett.org>. There are also a lot of people who
contributed code, gave ideas or requested features. Look them up in the
executable.

This man page was written by Philipp Frauenfelder <pfrauenf@debian.org>,
maintainer of the Debian package.  Maintenance is now taken over by
Cord Beermann.

.SH VERSION

Version of this manpage: $Id: calamaris.1,v 1.12 2000-05-13 20:06:45 cord Exp $

It describes the usage of Calamaris V2.30 and later.

Information about new releases, mailing lists, and other related issues
can be found from the 
.B Calamaris
home page at http://Calamaris.Cord.de/

.SH WARRANTY
.B Calamaris
comes with "absolutely no warranty".

.SH COPYRIGHT
Copyright (C) 1997, 1998, 1999 Cord Beermann

This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any later
version.

(If you modify and want to publish it under the name
.BR Calamaris , 
please ask me.  I don't want to confuse the 'audience' with many different
versions of the same name and/or Version number.  (This is not part of the
license, it is only a favour i asked of you.))

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 59 Temple
Place - Suite 330, Boston, MA 02111-1307, USA.
